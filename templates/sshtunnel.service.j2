[Unit]
Description=sshtunnel to host {{ sshtunnel_broker.middlebox_ip }}
After=network.target

[Service]
User={{ sshtunnel_broker.forward_user }}
ExecStart=/usr/bin/ssh -i {{ sshtunnel_broker.forward_home }}/.ssh/id_rsa -NT -o StrictHostKeyChecking=no -o ServerAliveInterval=60 -o ExitOnForwardFailure=yes -R {{ sshtunnel_onport }}:localhost:{{ sshtunnel_toport }} {{ sshtunnel_broker.middlebox_user }}@{{ sshtunnel_broker.middlebox_ip }}

# Restart every >2 seconds to avoid StartLimitInterval failure
RestartSec=5
Restart=always

[Install]
WantedBy=multi-user.target

# thanks https://gist.github.com/drmalex07/c0f9304deea566842490
